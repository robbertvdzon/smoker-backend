
<html>
<head>

    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <link rel="stylesheet" href="/resources/demos/style.css">
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

    <script>
        $( function() {
            $( "#datepicker" ).datepicker();
        } );
    </script>

    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <!--<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>-->
    <script type="text/javascript">

        var range = "2uur";

        function load(){
            loadCurrentStatus();
            google.charts.load('current', {'packages':['corechart']});
            google.charts.setOnLoadCallback(drawChart);
        }

        function loadCurrentStatus(){
            var last = $.ajax({
                url: "getlast",
                dataType: "json",
                async: false
            }).responseText;
            var lastObj = $.parseJSON(last);
            var temp = lastObj.temp;
            var sturing = lastObj.sturing;
            $('#currentState').html("Huidige temp: "+temp+" graden, zuurstofdoorvoer op "+sturing+"%");

        }

        function getData() {
            var jsonArrayData = [];
            var jsonData = $.ajax({
                url: "getall?range="+range,
                dataType: "json",
                async: false
            }).responseText;
            var jsonObj = $.parseJSON(jsonData);
            jsonArrayData.push(['Tijd', 'Temp', 'Fan'])
            for (i=0; i<jsonObj.length; i++){
                jsonArrayData.push([new Date(jsonObj[i].date), jsonObj[i].temp, jsonObj[i].sturing])
            }
            return new google.visualization.arrayToDataTable(jsonArrayData);

        }

        function drawChart() {
            var data = getData();

            var options = {
                title: 'Smoker',
                curveType: 'function',
                hAxis: {title: 'Tijd',
                    slantedText:true, slantedTextAngle:80},
                vAxis: {minValue: 80},
                explorer: {
                    actions: ['dragToZoom', 'rightClickToReset'],
                    axis: 'horizontal',
                    keepInBounds: true,
                    maxZoomIn: 4.0}
            };

            var chart = new google.visualization.LineChart(document.getElementById('chart_div'));
            chart.draw(data, options);

            chart.draw(data, options);
            view = new google.visualization.DataView(data);
            view.hideColumns([2]);
            chart.draw(view, options);

            var hideSal = document.getElementById("hideSales");
            hideSal.onclick = function()
            {
                view = new google.visualization.DataView(data);
                view.hideColumns([1]);
                chart.draw(view, options);
            }
            var hideExp = document.getElementById("hideExpenses");
            hideExp.onclick = function()
            {
                view = new google.visualization.DataView(data);
                view.hideColumns([2]);
                chart.draw(view, options);
            }
            var all = document.getElementById("all");
            all.onclick = function()
            {
                view = new google.visualization.DataView(data);
                chart.draw(view, options);
            }

        }

        $(document).ready(function() {
            $('input[type=radio][name=samplerange]').change(function() {
                if (this.value=="custom"){
                    range = "custom_"+$('#datepicker').val()+$('#van').val()+"_"+ $('#tot').val();
                }
                else {
                    range = this.value;
                }
                reload();
            });
            $('input[name=autorefresh]').change(function() {
                reload();
            });
            $('#datepicker').change(function() {
                $('#custom').prop('checked',true);
                range = "custom_"+$('#datepicker').val()+"_"+$('#van').val()+"_"+ $('#tot').val();
                reload();
            });
            $('#van').change(function() {
                $('#custom').prop('checked',true);
                range = "custom_"+$('#datepicker').val()+"_"+$('#van').val()+"_"+ $('#tot').val();
                reload();
            });
            $('#tot').change(function() {
                $('#custom').prop('checked',true);
                range = "custom_"+$('#datepicker').val()+"_"+$('#van').val()+"_"+ $('#tot').val();
                reload();
            });
        });

        setInterval(reload,5000);

        function reload(range){
            if ($('input[name=autorefresh]').is(":checked")){
                load();
            }
        }

        load();



    </script>
</head>
<body>

<form action="">
    <input type="radio" name="samplerange" value="2uur" checked> laatste 2 uur<br>
    <input type="radio" name="samplerange" value="8uur"> laatste 8 uur <br>
    <input type="radio" name="samplerange" value="24uur"> laatste 24 uur <br>
    <input type="radio" name="samplerange" value="alles"> alles <br>
    <input type="radio" name="samplerange" id="custom" value="custom"> custom :
    dag: <input type="text" id="datepicker">
    van
    <input type="text" id="van" value="00:00">
    tot
    <input type="text" id="tot" value="24:00">
    <br>

    <input type="checkbox" name="autorefresh" value="refresh" checked>Auto refresh
</form>

<div style="text-align: center;"><div style="width: 500px; margin: 0 auto;"><h1>
    <button type="button" id="hideSales"  >Alleen ventilator</button>
    <button type="button" id="hideExpenses"  >Alleen temp</button>
    <button type="button" id="all"  >Beide</button>
</h1></div></div>


<div style="text-align: center;"><div style="width: 100%; margin: 0 auto;"><h1>
    <p id="currentState">Huidige status ophalen..</p>
</h1></div></div>



<div id="chart_div" style="width: 100%; height: 500px"></div>

<form action="/connect/facebook" method="POST">
    <input type="hidden" name="scope" value="user_posts" />

    <div class="formInfo">
        <p>Connect to facebook</p>
    </div>
    <p><button type="submit">Connect to Facebook</button></p>
</form>

<a href="user">user info</a><br>
<a href="test">prop test</a><br>

</body>
</html>